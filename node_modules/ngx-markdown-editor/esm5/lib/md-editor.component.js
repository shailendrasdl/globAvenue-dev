import { __decorate, __metadata, __param, __values } from "tslib";
import { Component, ViewChild, forwardRef, Renderer2, Attribute, Input, Output, EventEmitter, ElementRef, NgZone } from '@angular/core';
import { NG_VALUE_ACCESSOR, NG_VALIDATORS } from '@angular/forms';
import { DomSanitizer } from '@angular/platform-browser';
var DEFAULT_EDITOR_OPTION = {
    showPreviewPanel: true,
    showBorder: true,
    hideIcons: [],
    usingFontAwesome5: false,
    scrollPastEnd: 0,
    enablePreviewContentClick: false,
    resizable: false
};
var MarkdownEditorComponent = /** @class */ (function () {
    function MarkdownEditorComponent(required, maxlength, _ngZone, _renderer2, _domSanitizer) {
        if (required === void 0) { required = false; }
        if (maxlength === void 0) { maxlength = -1; }
        this.required = required;
        this.maxlength = maxlength;
        this._ngZone = _ngZone;
        this._renderer2 = _renderer2;
        this._domSanitizer = _domSanitizer;
        this.hideToolbar = false;
        this.height = "300px";
        this._mode = 'editor';
        this._options = {};
        this.onEditorLoaded = new EventEmitter();
        this.onPreviewDomChanged = new EventEmitter();
        this.hideIcons = {};
        this.showPreviewPanel = true;
        this.isFullScreen = false;
        this.dragover = false;
        this.isUploading = false;
        this._onChange = function (_) { };
        this._onTouched = function () { };
    }
    MarkdownEditorComponent_1 = MarkdownEditorComponent;
    Object.defineProperty(MarkdownEditorComponent.prototype, "mode", {
        get: function () {
            return this._mode;
        },
        set: function (value) {
            var _this = this;
            this._mode = (!value || ['editor', 'preview'].indexOf(value.toLowerCase()) === -1)
                ? 'editor'
                : value;
            setTimeout(function () {
                if (_this._aceEditorIns && typeof _this._aceEditorIns.resize === 'function') {
                    _this._aceEditorIns.resize();
                }
            }, 100);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(MarkdownEditorComponent.prototype, "options", {
        get: function () {
            return this._options || {};
        },
        set: function (value) {
            var _options = Object.assign(DEFAULT_EDITOR_OPTION, {}, value);
            var _hideIcons = {};
            if (typeof _options.showPreviewPanel === 'boolean') {
                this.showPreviewPanel = _options.showPreviewPanel;
            }
            if (Array.isArray(_options.hideIcons)) {
                _options.hideIcons.forEach(function (v) { return _hideIcons[v] = true; });
            }
            this._options = _options;
            this.hideIcons = _hideIcons;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(MarkdownEditorComponent.prototype, "markdownValue", {
        //#region Markdown value and html value define
        get: function () {
            return this._markdownValue || '';
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(MarkdownEditorComponent.prototype, "_hasUploadFunction", {
        get: function () {
            return this.upload && this.upload instanceof Function;
        },
        enumerable: true,
        configurable: true
    });
    MarkdownEditorComponent.prototype.ngOnInit = function () {
        var markedRender = new marked.Renderer();
        markedRender.image = this._getRender('image');
        markedRender.code = this._getRender('code');
        markedRender.table = this._getRender('table');
        markedRender.listitem = this._getRender('listitem');
        var markedjsOpt = {
            renderer: markedRender,
            highlight: function (code) { return hljs.highlightAuto(code).value; }
        };
        this._markedJsOpt = Object.assign({}, markedjsOpt, this.options.markedjsOpt);
    };
    MarkdownEditorComponent.prototype.ngAfterViewInit = function () {
        var _this = this;
        var editorElement = this.aceEditorContainer.nativeElement;
        var editor = ace.edit(editorElement);
        editor.$blockScrolling = Infinity;
        editor.getSession().setUseWrapMode(true);
        editor.getSession().setMode("ace/mode/markdown");
        editor.setValue(this.markdownValue, 1);
        editor.setOption('scrollPastEnd', this._options.scrollPastEnd || 0);
        editor.on('change', function (e) {
            if (_this._isValueSettedByprogrammatically)
                return;
            var val = editor.getValue();
            _this._updateMarkdownValue(val, true);
            _this._onChange(_this.markdownValue);
        });
        editor.on('blur', function () { _this._onTouched(); });
        this.onEditorLoaded.next(editor);
        this._aceEditorIns = editor;
    };
    MarkdownEditorComponent.prototype.ngOnDestroy = function () {
        this._aceEditorIns && this._aceEditorIns.destroy();
    };
    MarkdownEditorComponent.prototype.writeValue = function (value) {
        this._updateMarkdownValue(value, false);
    };
    MarkdownEditorComponent.prototype.registerOnChange = function (fn) {
        this._onChange = fn;
    };
    MarkdownEditorComponent.prototype.registerOnTouched = function (fn) {
        this._onTouched = fn;
    };
    MarkdownEditorComponent.prototype.validate = function (c) {
        var result = null;
        if (this.required && this.markdownValue.length === 0) {
            result = { required: true };
        }
        if (this.maxlength > 0 && this.markdownValue.length > this.maxlength) {
            result = { maxlength: true };
        }
        return result;
    };
    MarkdownEditorComponent.prototype.insertContent = function (type, customContent) {
        if (!this._aceEditorIns)
            return;
        var selectedText = this._aceEditorIns.getSelectedText();
        var isSelected = !!selectedText;
        var startSize = 2;
        var initText = '';
        var range = this._aceEditorIns.selection.getRange();
        switch (type) {
            case 'Bold':
                initText = 'Bold Text';
                selectedText = "**" + (selectedText || initText) + "**";
                break;
            case 'Italic':
                initText = 'Italic Text';
                selectedText = "*" + (selectedText || initText) + "*";
                startSize = 1;
                break;
            case 'Heading':
                initText = 'Heading';
                selectedText = "# " + (selectedText || initText);
                break;
            case 'Refrence':
                initText = 'Refrence';
                selectedText = "> " + (selectedText || initText);
                break;
            case 'Link':
                selectedText = "[](http://)";
                startSize = 1;
                break;
            case 'Image':
                selectedText = "![](http://)";
                break;
            case 'Ul':
                selectedText = "- " + (selectedText || initText);
                break;
            case 'Ol':
                selectedText = "1. " + (selectedText || initText);
                startSize = 3;
                break;
            case 'Code':
                initText = 'Source Code';
                selectedText = "```language\r\n" + (selectedText || initText) + "\r\n```";
                startSize = 3;
                break;
            case 'Custom':
                selectedText = customContent;
                startSize = 0;
                break;
        }
        this._aceEditorIns.session.replace(range, selectedText);
        if (!isSelected) {
            range.start.column += startSize;
            range.end.column = range.start.column + initText.length;
            this._aceEditorIns.selection.setRange(range);
        }
        this._aceEditorIns.focus();
    };
    MarkdownEditorComponent.prototype.togglePreview = function () {
        this.showPreviewPanel = !this.showPreviewPanel;
        this.editorResize();
    };
    MarkdownEditorComponent.prototype.previewPanelClick = function (event) {
        if (this.options.enablePreviewContentClick !== true) {
            event.preventDefault();
            event.stopImmediatePropagation();
        }
    };
    MarkdownEditorComponent.prototype.fullScreen = function () {
        this.isFullScreen = !this.isFullScreen;
        this._renderer2.setStyle(document.body, 'overflowY', this.isFullScreen ? 'hidden' : 'auto');
        this.editorResize();
    };
    MarkdownEditorComponent.prototype.mdEditorResize = function (size) {
        this.editorResize();
    };
    MarkdownEditorComponent.prototype.editorResize = function (timeOut) {
        var _this = this;
        if (timeOut === void 0) { timeOut = 100; }
        if (!this._aceEditorIns)
            return;
        if (this._aceEditorResizeTimer)
            clearTimeout(this._aceEditorResizeTimer);
        this._aceEditorResizeTimer = setTimeout(function () {
            _this._aceEditorIns.resize();
            _this._aceEditorIns.focus();
        }, timeOut);
    };
    MarkdownEditorComponent.prototype.onDragover = function (evt) {
        evt.stopImmediatePropagation();
        evt.preventDefault();
        if (!this._hasUploadFunction)
            return;
        this.dragover = true;
    };
    MarkdownEditorComponent.prototype.onDrop = function (evt) {
        var _this = this;
        evt.stopImmediatePropagation();
        evt.preventDefault();
        if (!this._hasUploadFunction || this.isUploading)
            return;
        if (!evt.dataTransfer.files || evt.dataTransfer.files.length === 0) {
            this.dragover = false;
            return;
        }
        this.isUploading = true;
        Promise.resolve()
            .then(function () {
            return _this.upload(evt.dataTransfer.files);
        })
            .then(function (data) {
            var e_1, _a;
            if (Array.isArray(data)) {
                var msg = [];
                try {
                    for (var data_1 = __values(data), data_1_1 = data_1.next(); !data_1_1.done; data_1_1 = data_1.next()) {
                        var item = data_1_1.value;
                        var tempMsg = "[" + item.name + "](" + item.url + ")";
                        if (item.isImg) {
                            tempMsg = "!" + tempMsg;
                        }
                        msg.push(tempMsg);
                    }
                }
                catch (e_1_1) { e_1 = { error: e_1_1 }; }
                finally {
                    try {
                        if (data_1_1 && !data_1_1.done && (_a = data_1.return)) _a.call(data_1);
                    }
                    finally { if (e_1) throw e_1.error; }
                }
                _this.insertContent('Custom', msg.join('\r\n'));
            }
            else {
                console.warn('Invalid upload result. Please using follow this type `UploadResult`.');
            }
            _this.isUploading = false;
            _this.dragover = false;
        })
            .catch(function (err) {
            console.error(err);
            _this.isUploading = false;
            _this.dragover = false;
        });
    };
    MarkdownEditorComponent.prototype.onDragleave = function (evt) {
        evt.stopImmediatePropagation();
        evt.preventDefault();
        if (!this._hasUploadFunction)
            return;
        this.dragover = false;
    };
    MarkdownEditorComponent.prototype._updateMarkdownValue = function (value, changedByUser) {
        if (changedByUser === void 0) { changedByUser = false; }
        var normalizedValue = typeof value === 'string' ? value : (value || '').toString();
        if (this._markdownValue === normalizedValue)
            return;
        this._markdownValue = normalizedValue;
        this._updateDom();
        if (this._aceEditorIns && !changedByUser) {
            this._isValueSettedByprogrammatically = true;
            this._aceEditorIns.setValue(normalizedValue, 1);
            this._isValueSettedByprogrammatically = false;
        }
    };
    MarkdownEditorComponent.prototype._updateDom = function () {
        var _this = this;
        if (this._convertMarkdownToHtmlTimer)
            clearTimeout(this._convertMarkdownToHtmlTimer);
        this._convertMarkdownToHtmlTimer = setTimeout(function () {
            Promise.resolve(_this.markdownValue)
                .then(function (mdContent) {
                return (_this.preRender && _this.preRender instanceof Function) ? _this.preRender(mdContent) : mdContent;
            })
                .then(function (mdContent) {
                var html = marked(mdContent || '', _this._markedJsOpt);
                return (_this.postRender && _this.postRender instanceof Function) ? _this.postRender(html) : html;
            })
                .then(function (parsedHtml) {
                _this.previewHtml = _this._domSanitizer.bypassSecurityTrustHtml(parsedHtml);
                if (_this.previewContainer && _this.previewContainer.nativeElement) {
                    _this._ngZone.runOutsideAngular(function () {
                        _this._renderer2.setProperty(_this.previewContainer.nativeElement, 'innerHTML', parsedHtml);
                        setTimeout(function () { _this.onPreviewDomChanged.next(_this.previewContainer.nativeElement); }, 100);
                    });
                }
            })
                .catch(function (err) {
                console.error(err);
            });
        }, 100);
    };
    MarkdownEditorComponent.prototype._getRender = function (renderType) {
        var customRender = this.options && this.options.customRender && this.options.customRender[renderType];
        if (customRender && typeof customRender === 'function') {
            return customRender;
        }
        else {
            switch (renderType) {
                case 'image':
                    return function (href, title, text) {
                        var out = "<img style=\"max-width: 100%;\" src=\"" + href + "\" alt=\"" + text + "\"";
                        if (title) {
                            out += " title=\"" + title + "\"";
                        }
                        out += this.options.xhtml ? "/>" : ">";
                        return out;
                    };
                case 'code':
                    return function (code, language) {
                        var validLang = !!(language && hljs.getLanguage(language));
                        var highlighted = validLang ? hljs.highlight(language, code).value : code;
                        return "<pre style=\"padding: 0; border-radius: 0;\"><code class=\"hljs " + language + "\">" + highlighted + "</code></pre>";
                    };
                case 'table':
                    return function (header, body) {
                        return "<table class=\"table table-bordered\">\n<thead>\n" + header + "</thead>\n<tbody>\n" + body + "</tbody>\n</table>\n";
                    };
                case 'listitem':
                    return function (text, task, checked) {
                        if (/^\s*\[[x ]\]\s*/.test(text) || text.startsWith('<input')) {
                            if (text.startsWith('<input')) {
                                text = text
                                    .replace('<input disabled="" type="checkbox">', '<i class="fa fa-square-o"></i>')
                                    .replace('<input checked="" disabled="" type="checkbox">', '<i class="fa fa-check-square"></i>');
                            }
                            else {
                                text = text
                                    .replace(/^\s*\[ \]\s*/, '<i class="fa fa-square-o"></i> ')
                                    .replace(/^\s*\[x\]\s*/, '<i class="fa fa-check-square"></i> ');
                            }
                            return "<li>" + text + "</li>";
                        }
                        else {
                            return "<li>" + text + "</li>";
                        }
                    };
            }
        }
    };
    var MarkdownEditorComponent_1;
    MarkdownEditorComponent.ctorParameters = function () { return [
        { type: Boolean, decorators: [{ type: Attribute, args: ['required',] }] },
        { type: Number, decorators: [{ type: Attribute, args: ['maxlength',] }] },
        { type: NgZone },
        { type: Renderer2 },
        { type: DomSanitizer }
    ]; };
    __decorate([
        ViewChild('aceEditor', { static: true }),
        __metadata("design:type", ElementRef)
    ], MarkdownEditorComponent.prototype, "aceEditorContainer", void 0);
    __decorate([
        ViewChild('previewContainer', { static: true }),
        __metadata("design:type", ElementRef)
    ], MarkdownEditorComponent.prototype, "previewContainer", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Boolean)
    ], MarkdownEditorComponent.prototype, "hideToolbar", void 0);
    __decorate([
        Input(),
        __metadata("design:type", String)
    ], MarkdownEditorComponent.prototype, "height", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Function)
    ], MarkdownEditorComponent.prototype, "preRender", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Function)
    ], MarkdownEditorComponent.prototype, "postRender", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Function)
    ], MarkdownEditorComponent.prototype, "upload", void 0);
    __decorate([
        Input(),
        __metadata("design:type", String),
        __metadata("design:paramtypes", [String])
    ], MarkdownEditorComponent.prototype, "mode", null);
    __decorate([
        Input(),
        __metadata("design:type", Object),
        __metadata("design:paramtypes", [Object])
    ], MarkdownEditorComponent.prototype, "options", null);
    __decorate([
        Output(),
        __metadata("design:type", EventEmitter)
    ], MarkdownEditorComponent.prototype, "onEditorLoaded", void 0);
    __decorate([
        Output(),
        __metadata("design:type", EventEmitter)
    ], MarkdownEditorComponent.prototype, "onPreviewDomChanged", void 0);
    MarkdownEditorComponent = MarkdownEditorComponent_1 = __decorate([
        Component({
            selector: 'md-editor',
            template: "<div class=\"md-editor-container\" [class.font-awesome5]=\"options?.usingFontAwesome5\" [class.fullscreen]=\"isFullScreen\"\r\n  [class.md-editor-resizable]=\"options?.resizable\" [style.height]=\"height\">\r\n  <div class=\"md-layout\">\r\n    <div class=\"tool-bar\" *ngIf=\"!hideToolbar && mode != 'preview'\">\r\n      <div class=\"btn-group\">\r\n        <button class=\"btn btn-sm btn-default\" type=\"button\" title=\"Bold\" (click)=\"insertContent('Bold')\"\r\n          *ngIf=\"!hideIcons.Bold\">\r\n          <i class=\"fa fa-bold\"></i>\r\n        </button>\r\n        <button class=\"btn btn-sm btn-default\" type=\"button\" title=\"Italic\" (click)=\"insertContent('Italic')\"\r\n          *ngIf=\"!hideIcons.Italic\">\r\n          <i class=\"fa fa-italic\"></i>\r\n        </button>\r\n        <button class=\"btn btn-sm btn-default\" type=\"button\" title=\"Heading\" (click)=\"insertContent('Heading')\"\r\n          *ngIf=\"!hideIcons.Heading\">\r\n          <i class=\"fa fa-header\"></i>\r\n        </button>\r\n        <button class=\"btn btn-sm btn-default\" type=\"button\" title=\"Refrence\" (click)=\"insertContent('Refrence')\"\r\n          *ngIf=\"!hideIcons.Refrence\">\r\n          <i class=\"fa fa-quote-left\"></i>\r\n        </button>\r\n      </div>\r\n      <div class=\"btn-group\">\r\n        <button class=\"btn btn-sm btn-default\" type=\"button\" title=\"Link\" (click)=\"insertContent('Link')\"\r\n          *ngIf=\"!hideIcons.Link\">\r\n          <i class=\"fa fa-link\"></i>\r\n        </button>\r\n        <button class=\"btn btn-sm btn-default\" type=\"button\" title=\"Image\" (click)=\"insertContent('Image')\"\r\n          *ngIf=\"!hideIcons.Image\">\r\n          <i class=\"fa fa-image\"></i>\r\n        </button>\r\n      </div>\r\n      <div class=\"btn-group\">\r\n        <button class=\"btn btn-sm btn-default\" type=\"button\" title=\"Unordered List\" (click)=\"insertContent('Ul')\"\r\n          *ngIf=\"!hideIcons.Ul\">\r\n          <i class=\"fa fa-list-ul\"></i>\r\n        </button>\r\n        <button class=\"btn btn-sm btn-default\" type=\"button\" title=\"Ordered List\" (click)=\"insertContent('Ol')\"\r\n          *ngIf=\"!hideIcons.Ol\">\r\n          <i class=\"fa fa-list-ol\"></i>\r\n        </button>\r\n        <button class=\"btn btn-sm btn-default\" type=\"button\" title=\"Code Block\" (click)=\"insertContent('Code')\"\r\n          *ngIf=\"!hideIcons.Code\">\r\n          <i class=\"fa fa-file-code-o\"></i>\r\n        </button>\r\n      </div>\r\n      <div class=\"btn-group\">\r\n        <button class=\"btn btn-sm btn-default\" type=\"button\"\r\n          [attr.title]=\"showPreviewPanel ? 'Hide Preview' : 'Show Preview'\" (click)=\"togglePreview()\"\r\n          *ngIf=\"!hideIcons.TogglePreview\">\r\n          <i class=\"fa\" [class.fa-eye]=\"!showPreviewPanel\" [class.fa-eye-slash]=\"showPreviewPanel\"></i>\r\n        </button>\r\n      </div>\r\n      <div class=\"btn-group pull-right hide-split\">\r\n        <button class=\"btn btn-sm btn-default\" type=\"button\" [class.active]=\"isFullScreen\" (click)=\"fullScreen()\"\r\n          *ngIf=\"!hideIcons.FullScreen\">\r\n          <i class=\"fa\" [class.fa-arrows-alt]=\"!options?.usingFontAwesome5 || !isFullScreen\"\r\n            [class.fa-compress]=\"options?.usingFontAwesome5 && isFullScreen\"></i>\r\n        </button>\r\n      </div>\r\n    </div>\r\n    <div class=\"editor-container\">\r\n      <div [class.dragover]=\"dragover\" [style.display]=\"mode == 'preview' ? 'none' : null\"\r\n        (dragover)=\"onDragover($event)\">\r\n        <div class=\"drag-container\">\r\n          <div class=\"upload-loading\">\r\n            <i class=\"fa fa-upload\" *ngIf=\"!isUploading\"></i>\r\n            <i class=\"fa fa-spinner fa-pulse fa-fw\" *ngIf=\"isUploading\"></i>\r\n            <div class=\"text\">{{ isUploading ? 'Uploading' : 'Drag it here' }}</div>\r\n          </div>\r\n        </div>\r\n        <div class=\"drag-container drag-container-mask\" (drop)=\"onDrop($event)\" (dragleave)=\"onDragleave($event)\"></div>\r\n        <div class=\"editor-panel\">\r\n          <div class=\"ace-editor\" #aceEditor></div>\r\n        </div>\r\n      </div>\r\n      <div class=\"preview-container\" [style.display]=\"(mode == 'preview' || showPreviewPanel) ? 'block' : 'none'\"\r\n        (click)=\"previewPanelClick($event)\">\r\n        <div class=\"preview-panel\" #previewContainer></div>\r\n      </div>\r\n    </div>\r\n    <div class=\"md-footer\" *ngIf=\"maxlength > 0 && mode != 'preview'\">\r\n      <div class=\"text-right length-view\">\r\n        {{ markdownValue?.length }} / {{ maxlength }}\r\n      </div>\r\n      <div class=\"resize-btn\"></div>\r\n    </div>\r\n  </div>\r\n  <md-editor-resize-sensor *ngIf=\"options?.resizable\" (resize)=\"mdEditorResize($event)\"></md-editor-resize-sensor>\r\n</div>\r\n",
            providers: [
                {
                    provide: NG_VALUE_ACCESSOR,
                    useExisting: forwardRef(function () { return MarkdownEditorComponent_1; }),
                    multi: true
                },
                {
                    provide: NG_VALIDATORS,
                    useExisting: forwardRef(function () { return MarkdownEditorComponent_1; }),
                    multi: true
                }
            ],
            styles: ["@charset \"UTF-8\";.md-editor-container{position:relative;height:100%;margin-bottom:15px;border:1px solid rgba(0,0,0,.1)}.md-editor-container.fullscreen{margin:0;position:fixed;border:0;top:0;left:0;width:100%!important;height:100%!important;z-index:99999999}.md-editor-container.md-editor-resizable:not(.fullscreen){resize:both;overflow:hidden;display:inline-block;width:100%}.md-editor-container.md-editor-resizable:not(.fullscreen) .md-layout .editor-container{height:calc(100% - 70px)}.md-editor-container.md-editor-resizable:not(.fullscreen) .md-footer{z-index:-1}.md-editor-container.font-awesome5 .fa.fa-header::before{content:\"\uF1DC\"}.md-editor-container.font-awesome5 .fa.fa-file-code-o::before{content:\"\uF121\"}.md-editor-container.font-awesome5 .fa.fa-arrows-alt::before{content:\"\uF065\"}.md-editor-container .md-layout{height:100%;display:flex;flex-direction:column}.md-editor-container .md-layout .tool-bar{background-color:#f5f5f5;border-bottom:1px solid rgba(0,0,0,.1)}.md-editor-container .md-layout .tool-bar .btn-group{padding:6px}.md-editor-container .md-layout .tool-bar .btn-group:first-child>.btn:first-child::before{display:none}.md-editor-container .md-layout .tool-bar .btn-group>.btn:first-child::before{content:\" \";background-color:#a9a9a9;width:1px;height:24px;left:-9px;top:2px;position:absolute}.md-editor-container .md-layout .tool-bar .btn-group.hide-split>.btn:first-child::before{display:none}.md-editor-container .md-layout .tool-bar .btn{margin-bottom:0}.md-editor-container .md-layout .editor-container{flex:1;display:flex;height:calc(100% - 100px)}.md-editor-container .md-layout .editor-container>div{flex:1}.md-editor-container .md-layout .editor-container>div .drag-container{display:none}.md-editor-container .md-layout .editor-container>div.dragover{position:relative}.md-editor-container .md-layout .editor-container>div.dragover .drag-container{display:block;position:absolute;left:0;top:0;right:0;bottom:0;z-index:10;background-color:rgba(0,0,0,.4);display:flex;align-items:center;justify-content:center;font-size:50px;color:#fff}.md-editor-container .md-layout .editor-container>div.dragover .drag-container.drag-container-mask{background-color:transparent;z-index:11}.md-editor-container .md-layout .editor-container>div.dragover .drag-container .upload-loading{display:flex;flex-direction:column;align-items:center}.md-editor-container .md-layout .editor-container>div.dragover .drag-container .upload-loading .text{font-size:20px;margin-top:10px}.md-editor-container .md-layout .editor-container .editor-panel{height:100%}.md-editor-container .md-layout .editor-container .editor-panel .ace-editor{height:100%;min-height:100%}.md-editor-container .md-layout .preview-container{overflow:auto}.md-editor-container .md-layout .preview-container .preview-panel{height:100%;border-left:1px solid rgba(0,0,0,.1);background-color:#fff;padding:10px}.md-editor-container .md-layout .md-footer{background-color:#f0f0f0;border-top:1px solid rgba(0,0,0,.1);display:flex;align-items:center}.md-editor-container .md-layout .md-footer .length-view{flex:1;padding:4px 2px 0;font-size:12px;line-height:16px}.md-editor-container .md-layout .md-footer .resize-btn{width:17px}.md-editor-container .pull-right{float:right}"]
        }),
        __param(0, Attribute('required')),
        __param(1, Attribute('maxlength')),
        __metadata("design:paramtypes", [Boolean, Number, NgZone,
            Renderer2,
            DomSanitizer])
    ], MarkdownEditorComponent);
    return MarkdownEditorComponent;
}());
export { MarkdownEditorComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWQtZWRpdG9yLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC1tYXJrZG93bi1lZGl0b3IvIiwic291cmNlcyI6WyJsaWIvbWQtZWRpdG9yLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN4SSxPQUFPLEVBQUUsaUJBQWlCLEVBQXdCLGFBQWEsRUFBZ0QsTUFBTSxnQkFBZ0IsQ0FBQztBQUN0SSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFPekQsSUFBTSxxQkFBcUIsR0FBbUI7SUFDNUMsZ0JBQWdCLEVBQUUsSUFBSTtJQUN0QixVQUFVLEVBQUUsSUFBSTtJQUNoQixTQUFTLEVBQUUsRUFBRTtJQUNiLGlCQUFpQixFQUFFLEtBQUs7SUFDeEIsYUFBYSxFQUFFLENBQUM7SUFDaEIseUJBQXlCLEVBQUUsS0FBSztJQUNoQyxTQUFTLEVBQUUsS0FBSztDQUNqQixDQUFBO0FBb0JEO0lBMkVFLGlDQUNnQyxRQUF5QixFQUN4QixTQUFzQixFQUM3QyxPQUFlLEVBQ2YsVUFBcUIsRUFDckIsYUFBMkI7UUFKTCx5QkFBQSxFQUFBLGdCQUF5QjtRQUN4QiwwQkFBQSxFQUFBLGFBQXFCLENBQUM7UUFEdkIsYUFBUSxHQUFSLFFBQVEsQ0FBaUI7UUFDeEIsY0FBUyxHQUFULFNBQVMsQ0FBYTtRQUM3QyxZQUFPLEdBQVAsT0FBTyxDQUFRO1FBQ2YsZUFBVSxHQUFWLFVBQVUsQ0FBVztRQUNyQixrQkFBYSxHQUFiLGFBQWEsQ0FBYztRQTVFckIsZ0JBQVcsR0FBWSxLQUFLLENBQUM7UUFDN0IsV0FBTSxHQUFXLE9BQU8sQ0FBQztRQW1CakMsVUFBSyxHQUFXLFFBQVEsQ0FB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RSxVQUFVLENBQUMsY0FBTSxPQUFBLHlCQUF1QixFQUF2QixDQUF1QixDQUFDO29CQUN0RCxLQUFLLEVBQUUsSUFBSTtpQkFDWjtnQkFDRDtvQkFDRSxPQUFPLEVBQUUsYUFBYTtvQkFDdEIsV0FBVyxFQUFFLFVBQVUsQ0FBQyxjQUFNLE9BQUEseUJBQXVCLEVBQXZCLENBQXVCLENBQUM7b0JBQ3RELEtBQUssRUFBRSxJQUFJO2lCQUNaO2FBQ0Y7O1NBQ0YsQ0FBQztRQThFRyxXQUFBLFNBQVMsQ0FBQyxVQUFVLENBQUMsQ0FBQTtRQUNyQixXQUFBLFNBQVMsQ0FBQyxXQUFXLENBQUMsQ0FBQTswREFDTixNQUFNO1lBQ0gsU0FBUztZQUNOLFlBQVk7T0FoRjFCLHVCQUF1QixDQWtYbkM7SUFBRCw4QkFBQztDQUFBLEFBbFhELElBa1hDO1NBbFhZLHVCQUF1QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgVmlld0NoaWxkLCBmb3J3YXJkUmVmLCBSZW5kZXJlcjIsIEF0dHJpYnV0ZSwgSW5wdXQsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBFbGVtZW50UmVmLCBOZ1pvbmUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgTkdfVkFMVUVfQUNDRVNTT1IsIENvbnRyb2xWYWx1ZUFjY2Vzc29yLCBOR19WQUxJREFUT1JTLCBWYWxpZGF0b3IsIEFic3RyYWN0Q29udHJvbCwgVmFsaWRhdGlvbkVycm9ycyB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcclxuaW1wb3J0IHsgRG9tU2FuaXRpemVyIH0gZnJvbSAnQGFuZ3VsYXIvcGxhdGZvcm0tYnJvd3Nlcic7XHJcbmltcG9ydCB7IE1kRWRpdG9yT3B0aW9uIH0gZnJvbSAnLi9tZC1lZGl0b3IudHlwZXMnO1xyXG5cclxuZGVjbGFyZSBsZXQgYWNlOiBhbnk7XHJcbmRlY2xhcmUgbGV0IG1hcmtlZDogYW55O1xyXG5kZWNsYXJlIGxldCBobGpzOiBhbnk7XHJcblxyXG5jb25zdCBERUZBVUxUX0VESVRPUl9PUFRJT046IE1kRWRpdG9yT3B0aW9uID0ge1xyXG4gIHNob3dQcmV2aWV3UGFuZWw6IHRydWUsXHJcbiAgc2hvd0JvcmRlcjogdHJ1ZSxcclxuICBoaWRlSWNvbnM6IFtdLFxyXG4gIHVzaW5nRm9udEF3ZXNvbWU1OiBmYWxzZSxcclxuICBzY3JvbGxQYXN0RW5kOiAwLFxyXG4gIGVuYWJsZVByZXZpZXdDb250ZW50Q2xpY2s6IGZhbHNlLFxyXG4gIHJlc2l6YWJsZTogZmFsc2VcclxufVxyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdtZC1lZGl0b3InLFxyXG4gIHN0eWxlVXJsczogWycuL21kLWVkaXRvci5zY3NzJ10sXHJcbiAgdGVtcGxhdGVVcmw6ICcuL21kLWVkaXRvci5odG1sJyxcclxuICBwcm92aWRlcnM6IFtcclxuICAgIHtcclxuICAgICAgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsXHJcbiAgICAgIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IE1hcmtkb3duRWRpdG9yQ29tcG9uZW50KSxcclxuICAgICAgbXVsdGk6IHRydWVcclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgIHByb3ZpZGU6IE5HX1ZBTElEQVRPUlMsXHJcbiAgICAgIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IE1hcmtkb3duRWRpdG9yQ29tcG9uZW50KSxcclxuICAgICAgbXVsdGk6IHRydWVcclxuICAgIH1cclxuICBdXHJcbn0pXHJcblxyXG5leHBvcnQgY2xhc3MgTWFya2Rvd25FZGl0b3JDb21wb25lbnQgaW1wbGVtZW50cyBDb250cm9sVmFsdWVBY2Nlc3NvciwgVmFsaWRhdG9yIHtcclxuXHJcbiAgQFZpZXdDaGlsZCgnYWNlRWRpdG9yJywgeyBzdGF0aWM6IHRydWUgfSkgcHVibGljIGFjZUVkaXRvckNvbnRhaW5lcjogRWxlbWVudFJlZjtcclxuICBAVmlld0NoaWxkKCdwcmV2aWV3Q29udGFpbmVyJywgeyBzdGF0aWM6IHRydWUgfSkgcHVibGljIHByZXZpZXdDb250YWluZXI6IEVsZW1lbnRSZWY7XHJcbiAgQElucHV0KCkgcHVibGljIGhpZGVUb29sYmFyOiBib29sZWFuID0gZmFsc2U7XHJcbiAgQElucHV0KCkgcHVibGljIGhlaWdodDogc3RyaW5nID0gXCIzMDBweFwiO1xyXG4gIEBJbnB1dCgpIHB1YmxpYyBwcmVSZW5kZXI6IEZ1bmN0aW9uO1xyXG4gIEBJbnB1dCgpIHB1YmxpYyBwb3N0UmVuZGVyOiBGdW5jdGlvbjtcclxuICBASW5wdXQoKSBwdWJsaWMgdXBsb2FkOiBGdW5jdGlvbjtcclxuXHJcbiAgQElucHV0KClcclxuICBwdWJsaWMgZ2V0IG1vZGUoKTogc3RyaW5nIHtcclxuICAgIHJldHVybiB0aGlzLl9tb2RlO1xyXG4gIH1cclxuICBwdWJsaWMgc2V0IG1vZGUodmFsdWU6IHN0cmluZykge1xyXG4gICAgdGhpcy5fbW9kZSA9ICghdmFsdWUgfHwgWydlZGl0b3InLCAncHJldmlldyddLmluZGV4T2YodmFsdWUudG9Mb3dlckNhc2UoKSkgPT09IC0xKVxyXG4gICAgICA/ICdlZGl0b3InXHJcbiAgICAgIDogdmFsdWU7XHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgaWYgKHRoaXMuX2FjZUVkaXRvcklucyAmJiB0eXBlb2YgdGhpcy5fYWNlRWRpdG9ySW5zLnJlc2l6ZSA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgIHRoaXMuX2FjZUVkaXRvcklucy5yZXNpemUoKTtcclxuICAgICAgfVxyXG4gICAgfSwgMTAwKTtcclxuICB9XHJcbiAgcHJpdmF0ZSBfbW9kZTogc3RyaW5nID0gJ2VkaXRvcic7XHJcblxyXG4gIEBJbnB1dCgpXHJcbiAgcHVibGljIGdldCBvcHRpb25zKCk6IE1kRWRpdG9yT3B0aW9uIHtcclxuICAgIHJldHVybiB0aGlzLl9vcHRpb25zIHx8IHt9O1xyXG4gIH1cclxuICBwdWJsaWMgc2V0IG9wdGlvbnModmFsdWU6IE1kRWRpdG9yT3B0aW9uKSB7XHJcbiAgICBsZXQgX29wdGlvbnMgPSBPYmplY3QuYXNzaWduKERFRkFVTFRfRURJVE9SX09QVElPTiwge30sIHZhbHVlKTtcclxuICAgIGxldCBfaGlkZUljb25zID0ge307XHJcbiAgICBpZiAodHlwZW9mIF9vcHRpb25zLnNob3dQcmV2aWV3UGFuZWwgPT09ICdib29sZWFuJykge1xyXG4gICAgICB0aGlzLnNob3dQcmV2aWV3UGFuZWwgPSBfb3B0aW9ucy5zaG93UHJldmlld1BhbmVsO1xyXG4gICAgfVxyXG4gICAgaWYgKEFycmF5LmlzQXJyYXkoX29wdGlvbnMuaGlkZUljb25zKSkge1xyXG4gICAgICBfb3B0aW9ucy5oaWRlSWNvbnMuZm9yRWFjaCgodjogYW55KSA9PiBfaGlkZUljb25zW3ZdID0gdHJ1ZSk7XHJcbiAgICB9XHJcbiAgICB0aGlzLl9vcHRpb25zID0gX29wdGlvbnM7XHJcbiAgICB0aGlzLmhpZGVJY29ucyA9IF9oaWRlSWNvbnM7XHJcbiAgfVxyXG4gIHByaXZhdGUgX29wdGlvbnM6IGFueSA9IHt9O1xyXG5cclxuICBAT3V0cHV0KCkgcHVibGljIG9uRWRpdG9yTG9hZGVkOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG4gIEBPdXRwdXQoKSBwdWJsaWMgb25QcmV2aWV3RG9tQ2hhbmdlZDogRXZlbnRFbWl0dGVyPEhUTUxFbGVtZW50PiA9IG5ldyBFdmVudEVtaXR0ZXI8SFRNTEVsZW1lbnQ+KCk7XHJcblxyXG4gIHB1YmxpYyBoaWRlSWNvbnM6IGFueSA9IHt9O1xyXG4gIHB1YmxpYyBzaG93UHJldmlld1BhbmVsOiBib29sZWFuID0gdHJ1ZTtcclxuICBwdWJsaWMgaXNGdWxsU2NyZWVuOiBib29sZWFuID0gZmFsc2U7XHJcbiAgcHVibGljIGRyYWdvdmVyOiBib29sZWFuID0gZmFsc2U7XHJcbiAgcHVibGljIGlzVXBsb2FkaW5nOiBib29sZWFuID0gZmFsc2U7XHJcblxyXG4gIC8vI3JlZ2lvbiBNYXJrZG93biB2YWx1ZSBhbmQgaHRtbCB2YWx1ZSBkZWZpbmVcclxuICBwdWJsaWMgZ2V0IG1hcmtkb3duVmFsdWUoKTogc3RyaW5nIHtcclxuICAgIHJldHVybiB0aGlzLl9tYXJrZG93blZhbHVlIHx8ICcnO1xyXG4gIH1cclxuICBwcml2YXRlIF9tYXJrZG93blZhbHVlOiBzdHJpbmc7XHJcblxyXG4gIHB1YmxpYyBwcmV2aWV3SHRtbDogYW55O1xyXG4gIC8vI2VuZHJlZ2lvblxyXG5cclxuXHJcbiAgcHJpdmF0ZSBfYWNlRWRpdG9ySW5zOiBhbnk7XHJcbiAgcHJpdmF0ZSBfYWNlRWRpdG9yUmVzaXplVGltZXI6IGFueTtcclxuICBwcml2YXRlIF9jb252ZXJ0TWFya2Rvd25Ub0h0bWxUaW1lcjogYW55O1xyXG4gIHByaXZhdGUgX21hcmtlZEpzT3B0OiBhbnk7XHJcbiAgcHJpdmF0ZSBfaXNWYWx1ZVNldHRlZEJ5cHJvZ3JhbW1hdGljYWxseTogYm9vbGVhbjtcclxuICBwcml2YXRlIGdldCBfaGFzVXBsb2FkRnVuY3Rpb24oKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy51cGxvYWQgJiYgdGhpcy51cGxvYWQgaW5zdGFuY2VvZiBGdW5jdGlvbjtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgX29uQ2hhbmdlID0gKF86IGFueSkgPT4geyB9O1xyXG4gIHByaXZhdGUgX29uVG91Y2hlZCA9ICgpID0+IHsgfTtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBAQXR0cmlidXRlKCdyZXF1aXJlZCcpIHB1YmxpYyByZXF1aXJlZDogYm9vbGVhbiA9IGZhbHNlLFxyXG4gICAgQEF0dHJpYnV0ZSgnbWF4bGVuZ3RoJykgcHVibGljIG1heGxlbmd0aDogbnVtYmVyID0gLTEsXHJcbiAgICBwcml2YXRlIF9uZ1pvbmU6IE5nWm9uZSxcclxuICAgIHByaXZhdGUgX3JlbmRlcmVyMjogUmVuZGVyZXIyLFxyXG4gICAgcHJpdmF0ZSBfZG9tU2FuaXRpemVyOiBEb21TYW5pdGl6ZXIpIHtcclxuXHJcbiAgfVxyXG5cclxuICBuZ09uSW5pdCgpIHtcclxuICAgIGxldCBtYXJrZWRSZW5kZXIgPSBuZXcgbWFya2VkLlJlbmRlcmVyKCk7XHJcbiAgICBtYXJrZWRSZW5kZXIuaW1hZ2UgPSB0aGlzLl9nZXRSZW5kZXIoJ2ltYWdlJyk7XHJcbiAgICBtYXJrZWRSZW5kZXIuY29kZSA9IHRoaXMuX2dldFJlbmRlcignY29kZScpO1xyXG4gICAgbWFya2VkUmVuZGVyLnRhYmxlID0gdGhpcy5fZ2V0UmVuZGVyKCd0YWJsZScpO1xyXG4gICAgbWFya2VkUmVuZGVyLmxpc3RpdGVtID0gdGhpcy5fZ2V0UmVuZGVyKCdsaXN0aXRlbScpO1xyXG4gICAgbGV0IG1hcmtlZGpzT3B0ID0ge1xyXG4gICAgICByZW5kZXJlcjogbWFya2VkUmVuZGVyLFxyXG4gICAgICBoaWdobGlnaHQ6IChjb2RlOiBhbnkpID0+IGhsanMuaGlnaGxpZ2h0QXV0byhjb2RlKS52YWx1ZVxyXG4gICAgfTtcclxuICAgIHRoaXMuX21hcmtlZEpzT3B0ID0gT2JqZWN0LmFzc2lnbih7fSwgbWFya2VkanNPcHQsIHRoaXMub3B0aW9ucy5tYXJrZWRqc09wdCk7XHJcbiAgfVxyXG5cclxuICBuZ0FmdGVyVmlld0luaXQoKSB7XHJcbiAgICBsZXQgZWRpdG9yRWxlbWVudCA9IHRoaXMuYWNlRWRpdG9yQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQ7XHJcbiAgICBsZXQgZWRpdG9yID0gYWNlLmVkaXQoZWRpdG9yRWxlbWVudCk7XHJcbiAgICBlZGl0b3IuJGJsb2NrU2Nyb2xsaW5nID0gSW5maW5pdHk7XHJcbiAgICBlZGl0b3IuZ2V0U2Vzc2lvbigpLnNldFVzZVdyYXBNb2RlKHRydWUpO1xyXG4gICAgZWRpdG9yLmdldFNlc3Npb24oKS5zZXRNb2RlKFwiYWNlL21vZGUvbWFya2Rvd25cIik7XHJcbiAgICBlZGl0b3Iuc2V0VmFsdWUodGhpcy5tYXJrZG93blZhbHVlLCAxKTtcclxuICAgIGVkaXRvci5zZXRPcHRpb24oJ3Njcm9sbFBhc3RFbmQnLCB0aGlzLl9vcHRpb25zLnNjcm9sbFBhc3RFbmQgfHwgMCk7XHJcblxyXG4gICAgZWRpdG9yLm9uKCdjaGFuZ2UnLCAoZTogYW55KSA9PiB7XHJcbiAgICAgIGlmICh0aGlzLl9pc1ZhbHVlU2V0dGVkQnlwcm9ncmFtbWF0aWNhbGx5KSByZXR1cm47XHJcbiAgICAgIGxldCB2YWwgPSBlZGl0b3IuZ2V0VmFsdWUoKTtcclxuICAgICAgdGhpcy5fdXBkYXRlTWFya2Rvd25WYWx1ZSh2YWwsIHRydWUpO1xyXG4gICAgICB0aGlzLl9vbkNoYW5nZSh0aGlzLm1hcmtkb3duVmFsdWUpO1xyXG4gICAgfSk7XHJcbiAgICBlZGl0b3Iub24oJ2JsdXInLCAoKSA9PiB7IHRoaXMuX29uVG91Y2hlZCgpIH0pO1xyXG5cclxuICAgIHRoaXMub25FZGl0b3JMb2FkZWQubmV4dChlZGl0b3IpO1xyXG4gICAgdGhpcy5fYWNlRWRpdG9ySW5zID0gZWRpdG9yO1xyXG4gIH1cclxuXHJcbiAgbmdPbkRlc3Ryb3koKSB7XHJcbiAgICB0aGlzLl9hY2VFZGl0b3JJbnMgJiYgdGhpcy5fYWNlRWRpdG9ySW5zLmRlc3Ryb3koKTtcclxuICB9XHJcblxyXG4gIHdyaXRlVmFsdWUodmFsdWU6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgdGhpcy5fdXBkYXRlTWFya2Rvd25WYWx1ZSh2YWx1ZSwgZmFsc2UpO1xyXG4gIH1cclxuXHJcbiAgcmVnaXN0ZXJPbkNoYW5nZShmbjogKF86IGFueSkgPT4ge30pOiB2b2lkIHtcclxuICAgIHRoaXMuX29uQ2hhbmdlID0gZm47XHJcbiAgfVxyXG5cclxuICByZWdpc3Rlck9uVG91Y2hlZChmbjogKCkgPT4ge30pOiB2b2lkIHtcclxuICAgIHRoaXMuX29uVG91Y2hlZCA9IGZuO1xyXG4gIH1cclxuXHJcbiAgdmFsaWRhdGUoYzogQWJzdHJhY3RDb250cm9sKTogVmFsaWRhdGlvbkVycm9ycyB7XHJcbiAgICBsZXQgcmVzdWx0OiBhbnkgPSBudWxsO1xyXG4gICAgaWYgKHRoaXMucmVxdWlyZWQgJiYgdGhpcy5tYXJrZG93blZhbHVlLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICByZXN1bHQgPSB7IHJlcXVpcmVkOiB0cnVlIH07XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5tYXhsZW5ndGggPiAwICYmIHRoaXMubWFya2Rvd25WYWx1ZS5sZW5ndGggPiB0aGlzLm1heGxlbmd0aCkge1xyXG4gICAgICByZXN1bHQgPSB7IG1heGxlbmd0aDogdHJ1ZSB9O1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9XHJcblxyXG4gIGluc2VydENvbnRlbnQodHlwZTogc3RyaW5nLCBjdXN0b21Db250ZW50Pzogc3RyaW5nKSB7XHJcbiAgICBpZiAoIXRoaXMuX2FjZUVkaXRvcklucykgcmV0dXJuO1xyXG4gICAgbGV0IHNlbGVjdGVkVGV4dCA9IHRoaXMuX2FjZUVkaXRvcklucy5nZXRTZWxlY3RlZFRleHQoKTtcclxuICAgIGxldCBpc1NlbGVjdGVkID0gISFzZWxlY3RlZFRleHQ7XHJcbiAgICBsZXQgc3RhcnRTaXplID0gMjtcclxuICAgIGxldCBpbml0VGV4dDogc3RyaW5nID0gJyc7XHJcbiAgICBsZXQgcmFuZ2UgPSB0aGlzLl9hY2VFZGl0b3JJbnMuc2VsZWN0aW9uLmdldFJhbmdlKCk7XHJcbiAgICBzd2l0Y2ggKHR5cGUpIHtcclxuICAgICAgY2FzZSAnQm9sZCc6XHJcbiAgICAgICAgaW5pdFRleHQgPSAnQm9sZCBUZXh0JztcclxuICAgICAgICBzZWxlY3RlZFRleHQgPSBgKioke3NlbGVjdGVkVGV4dCB8fCBpbml0VGV4dH0qKmA7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ0l0YWxpYyc6XHJcbiAgICAgICAgaW5pdFRleHQgPSAnSXRhbGljIFRleHQnO1xyXG4gICAgICAgIHNlbGVjdGVkVGV4dCA9IGAqJHtzZWxlY3RlZFRleHQgfHwgaW5pdFRleHR9KmA7XHJcbiAgICAgICAgc3RhcnRTaXplID0gMTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnSGVhZGluZyc6XHJcbiAgICAgICAgaW5pdFRleHQgPSAnSGVhZGluZyc7XHJcbiAgICAgICAgc2VsZWN0ZWRUZXh0ID0gYCMgJHtzZWxlY3RlZFRleHQgfHwgaW5pdFRleHR9YDtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnUmVmcmVuY2UnOlxyXG4gICAgICAgIGluaXRUZXh0ID0gJ1JlZnJlbmNlJztcclxuICAgICAgICBzZWxlY3RlZFRleHQgPSBgPiAke3NlbGVjdGVkVGV4dCB8fCBpbml0VGV4dH1gO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdMaW5rJzpcclxuICAgICAgICBzZWxlY3RlZFRleHQgPSBgW10oaHR0cDovLylgO1xyXG4gICAgICAgIHN0YXJ0U2l6ZSA9IDE7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ0ltYWdlJzpcclxuICAgICAgICBzZWxlY3RlZFRleHQgPSBgIVtdKGh0dHA6Ly8pYDtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnVWwnOlxyXG4gICAgICAgIHNlbGVjdGVkVGV4dCA9IGAtICR7c2VsZWN0ZWRUZXh0IHx8IGluaXRUZXh0fWBcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnT2wnOlxyXG4gICAgICAgIHNlbGVjdGVkVGV4dCA9IGAxLiAke3NlbGVjdGVkVGV4dCB8fCBpbml0VGV4dH1gXHJcbiAgICAgICAgc3RhcnRTaXplID0gMztcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnQ29kZSc6XHJcbiAgICAgICAgaW5pdFRleHQgPSAnU291cmNlIENvZGUnO1xyXG4gICAgICAgIHNlbGVjdGVkVGV4dCA9IFwiYGBgbGFuZ3VhZ2VcXHJcXG5cIiArIChzZWxlY3RlZFRleHQgfHwgaW5pdFRleHQpICsgXCJcXHJcXG5gYGBcIjtcclxuICAgICAgICBzdGFydFNpemUgPSAzO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdDdXN0b20nOlxyXG4gICAgICAgIHNlbGVjdGVkVGV4dCA9IGN1c3RvbUNvbnRlbnQ7XHJcbiAgICAgICAgc3RhcnRTaXplID0gMDtcclxuICAgICAgICBicmVhaztcclxuICAgIH1cclxuICAgIHRoaXMuX2FjZUVkaXRvcklucy5zZXNzaW9uLnJlcGxhY2UocmFuZ2UsIHNlbGVjdGVkVGV4dCk7XHJcbiAgICBpZiAoIWlzU2VsZWN0ZWQpIHtcclxuICAgICAgcmFuZ2Uuc3RhcnQuY29sdW1uICs9IHN0YXJ0U2l6ZTtcclxuICAgICAgcmFuZ2UuZW5kLmNvbHVtbiA9IHJhbmdlLnN0YXJ0LmNvbHVtbiArIGluaXRUZXh0Lmxlbmd0aDtcclxuICAgICAgdGhpcy5fYWNlRWRpdG9ySW5zLnNlbGVjdGlvbi5zZXRSYW5nZShyYW5nZSk7XHJcbiAgICB9XHJcbiAgICB0aGlzLl9hY2VFZGl0b3JJbnMuZm9jdXMoKTtcclxuICB9XHJcblxyXG4gIHRvZ2dsZVByZXZpZXcoKSB7XHJcbiAgICB0aGlzLnNob3dQcmV2aWV3UGFuZWwgPSAhdGhpcy5zaG93UHJldmlld1BhbmVsO1xyXG4gICAgdGhpcy5lZGl0b3JSZXNpemUoKTtcclxuICB9XHJcblxyXG4gIHByZXZpZXdQYW5lbENsaWNrKGV2ZW50OiBFdmVudCkge1xyXG4gICAgaWYgKHRoaXMub3B0aW9ucy5lbmFibGVQcmV2aWV3Q29udGVudENsaWNrICE9PSB0cnVlKSB7XHJcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgIGV2ZW50LnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZnVsbFNjcmVlbigpIHtcclxuICAgIHRoaXMuaXNGdWxsU2NyZWVuID0gIXRoaXMuaXNGdWxsU2NyZWVuO1xyXG4gICAgdGhpcy5fcmVuZGVyZXIyLnNldFN0eWxlKGRvY3VtZW50LmJvZHksICdvdmVyZmxvd1knLCB0aGlzLmlzRnVsbFNjcmVlbiA/ICdoaWRkZW4nIDogJ2F1dG8nKTtcclxuICAgIHRoaXMuZWRpdG9yUmVzaXplKCk7XHJcbiAgfVxyXG5cclxuICBtZEVkaXRvclJlc2l6ZShzaXplOiBhbnkpIHtcclxuICAgIHRoaXMuZWRpdG9yUmVzaXplKCk7XHJcbiAgfVxyXG5cclxuICBlZGl0b3JSZXNpemUodGltZU91dDogbnVtYmVyID0gMTAwKSB7XHJcbiAgICBpZiAoIXRoaXMuX2FjZUVkaXRvcklucykgcmV0dXJuXHJcbiAgICBpZiAodGhpcy5fYWNlRWRpdG9yUmVzaXplVGltZXIpIGNsZWFyVGltZW91dCh0aGlzLl9hY2VFZGl0b3JSZXNpemVUaW1lcik7XHJcbiAgICB0aGlzLl9hY2VFZGl0b3JSZXNpemVUaW1lciA9IHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICB0aGlzLl9hY2VFZGl0b3JJbnMucmVzaXplKCk7XHJcbiAgICAgIHRoaXMuX2FjZUVkaXRvcklucy5mb2N1cygpO1xyXG4gICAgfSwgdGltZU91dCk7XHJcbiAgfVxyXG5cclxuICBvbkRyYWdvdmVyKGV2dDogRHJhZ0V2ZW50KSB7XHJcbiAgICBldnQuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XHJcbiAgICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICAgIGlmICghdGhpcy5faGFzVXBsb2FkRnVuY3Rpb24pIHJldHVybjtcclxuICAgIHRoaXMuZHJhZ292ZXIgPSB0cnVlO1xyXG4gIH1cclxuXHJcbiAgb25Ecm9wKGV2dDogRHJhZ0V2ZW50KSB7XHJcbiAgICBldnQuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XHJcbiAgICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICAgIGlmICghdGhpcy5faGFzVXBsb2FkRnVuY3Rpb24gfHwgdGhpcy5pc1VwbG9hZGluZykgcmV0dXJuO1xyXG5cclxuICAgIGlmICghZXZ0LmRhdGFUcmFuc2Zlci5maWxlcyB8fCBldnQuZGF0YVRyYW5zZmVyLmZpbGVzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICB0aGlzLmRyYWdvdmVyID0gZmFsc2U7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmlzVXBsb2FkaW5nID0gdHJ1ZTtcclxuICAgIFByb21pc2UucmVzb2x2ZSgpXHJcbiAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy51cGxvYWQoZXZ0LmRhdGFUcmFuc2Zlci5maWxlcyk7XHJcbiAgICAgIH0pXHJcbiAgICAgIC50aGVuKGRhdGEgPT4ge1xyXG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KGRhdGEpKSB7XHJcbiAgICAgICAgICBsZXQgbXNnID0gW107XHJcbiAgICAgICAgICBmb3IgKGxldCBpdGVtIG9mIGRhdGEpIHtcclxuICAgICAgICAgICAgbGV0IHRlbXBNc2cgPSBgWyR7aXRlbS5uYW1lfV0oJHtpdGVtLnVybH0pYDtcclxuICAgICAgICAgICAgaWYgKGl0ZW0uaXNJbWcpIHtcclxuICAgICAgICAgICAgICB0ZW1wTXNnID0gYCEke3RlbXBNc2d9YDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBtc2cucHVzaCh0ZW1wTXNnKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHRoaXMuaW5zZXJ0Q29udGVudCgnQ3VzdG9tJywgbXNnLmpvaW4oJ1xcclxcbicpKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgY29uc29sZS53YXJuKCdJbnZhbGlkIHVwbG9hZCByZXN1bHQuIFBsZWFzZSB1c2luZyBmb2xsb3cgdGhpcyB0eXBlIGBVcGxvYWRSZXN1bHRgLicpXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaXNVcGxvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmRyYWdvdmVyID0gZmFsc2U7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaChlcnIgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcclxuICAgICAgICB0aGlzLmlzVXBsb2FkaW5nID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5kcmFnb3ZlciA9IGZhbHNlO1xyXG4gICAgICB9KTtcclxuICB9XHJcblxyXG4gIG9uRHJhZ2xlYXZlKGV2dDogRHJhZ0V2ZW50KSB7XHJcbiAgICBldnQuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XHJcbiAgICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICAgIGlmICghdGhpcy5faGFzVXBsb2FkRnVuY3Rpb24pIHJldHVybjtcclxuICAgIHRoaXMuZHJhZ292ZXIgPSBmYWxzZTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgX3VwZGF0ZU1hcmtkb3duVmFsdWUodmFsdWU6IGFueSwgY2hhbmdlZEJ5VXNlcjogYm9vbGVhbiA9IGZhbHNlKSB7XHJcbiAgICBjb25zdCBub3JtYWxpemVkVmFsdWUgPSB0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnID8gdmFsdWUgOiAodmFsdWUgfHwgJycpLnRvU3RyaW5nKCk7XHJcbiAgICBpZiAodGhpcy5fbWFya2Rvd25WYWx1ZSA9PT0gbm9ybWFsaXplZFZhbHVlKSByZXR1cm47XHJcbiAgICB0aGlzLl9tYXJrZG93blZhbHVlID0gbm9ybWFsaXplZFZhbHVlO1xyXG4gICAgdGhpcy5fdXBkYXRlRG9tKCk7XHJcbiAgICBpZiAodGhpcy5fYWNlRWRpdG9ySW5zICYmICFjaGFuZ2VkQnlVc2VyKSB7XHJcbiAgICAgIHRoaXMuX2lzVmFsdWVTZXR0ZWRCeXByb2dyYW1tYXRpY2FsbHkgPSB0cnVlO1xyXG4gICAgICB0aGlzLl9hY2VFZGl0b3JJbnMuc2V0VmFsdWUobm9ybWFsaXplZFZhbHVlLCAxKTtcclxuICAgICAgdGhpcy5faXNWYWx1ZVNldHRlZEJ5cHJvZ3JhbW1hdGljYWxseSA9IGZhbHNlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBfdXBkYXRlRG9tKCkge1xyXG4gICAgaWYgKHRoaXMuX2NvbnZlcnRNYXJrZG93blRvSHRtbFRpbWVyKSBjbGVhclRpbWVvdXQodGhpcy5fY29udmVydE1hcmtkb3duVG9IdG1sVGltZXIpO1xyXG4gICAgdGhpcy5fY29udmVydE1hcmtkb3duVG9IdG1sVGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgUHJvbWlzZS5yZXNvbHZlKHRoaXMubWFya2Rvd25WYWx1ZSlcclxuICAgICAgICAudGhlbigobWRDb250ZW50KSA9PiB7XHJcbiAgICAgICAgICByZXR1cm4gKHRoaXMucHJlUmVuZGVyICYmIHRoaXMucHJlUmVuZGVyIGluc3RhbmNlb2YgRnVuY3Rpb24pID8gdGhpcy5wcmVSZW5kZXIobWRDb250ZW50KSA6IG1kQ29udGVudDtcclxuICAgICAgICB9KVxyXG4gICAgICAgIC50aGVuKG1kQ29udGVudCA9PiB7XHJcbiAgICAgICAgICBsZXQgaHRtbCA9IG1hcmtlZChtZENvbnRlbnQgfHwgJycsIHRoaXMuX21hcmtlZEpzT3B0KTtcclxuICAgICAgICAgIHJldHVybiAodGhpcy5wb3N0UmVuZGVyICYmIHRoaXMucG9zdFJlbmRlciBpbnN0YW5jZW9mIEZ1bmN0aW9uKSA/IHRoaXMucG9zdFJlbmRlcihodG1sKSA6IGh0bWw7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAudGhlbihwYXJzZWRIdG1sID0+IHtcclxuICAgICAgICAgIHRoaXMucHJldmlld0h0bWwgPSB0aGlzLl9kb21TYW5pdGl6ZXIuYnlwYXNzU2VjdXJpdHlUcnVzdEh0bWwocGFyc2VkSHRtbCk7XHJcbiAgICAgICAgICBpZiAodGhpcy5wcmV2aWV3Q29udGFpbmVyICYmIHRoaXMucHJldmlld0NvbnRhaW5lci5uYXRpdmVFbGVtZW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMuX25nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgdGhpcy5fcmVuZGVyZXIyLnNldFByb3BlcnR5KHRoaXMucHJldmlld0NvbnRhaW5lci5uYXRpdmVFbGVtZW50LCAnaW5uZXJIVE1MJywgcGFyc2VkSHRtbCk7XHJcbiAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7IHRoaXMub25QcmV2aWV3RG9tQ2hhbmdlZC5uZXh0KHRoaXMucHJldmlld0NvbnRhaW5lci5uYXRpdmVFbGVtZW50KTsgfSwgMTAwKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goZXJyID0+IHtcclxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcclxuICAgICAgICB9KVxyXG4gICAgfSwgMTAwKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgX2dldFJlbmRlcihyZW5kZXJUeXBlOiAnaW1hZ2UnIHwgJ3RhYmxlJyB8ICdjb2RlJyB8ICdsaXN0aXRlbScpIHtcclxuICAgIGxldCBjdXN0b21SZW5kZXIgPSB0aGlzLm9wdGlvbnMgJiYgdGhpcy5vcHRpb25zLmN1c3RvbVJlbmRlciAmJiB0aGlzLm9wdGlvbnMuY3VzdG9tUmVuZGVyW3JlbmRlclR5cGVdO1xyXG4gICAgaWYgKGN1c3RvbVJlbmRlciAmJiB0eXBlb2YgY3VzdG9tUmVuZGVyID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIHJldHVybiBjdXN0b21SZW5kZXI7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBzd2l0Y2ggKHJlbmRlclR5cGUpIHtcclxuICAgICAgICBjYXNlICdpbWFnZSc6XHJcbiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGhyZWY6IHN0cmluZywgdGl0bGU6IHN0cmluZywgdGV4dDogc3RyaW5nKSB7XHJcbiAgICAgICAgICAgIGxldCBvdXQgPSBgPGltZyBzdHlsZT1cIm1heC13aWR0aDogMTAwJTtcIiBzcmM9XCIke2hyZWZ9XCIgYWx0PVwiJHt0ZXh0fVwiYDtcclxuICAgICAgICAgICAgaWYgKHRpdGxlKSB7XHJcbiAgICAgICAgICAgICAgb3V0ICs9IGAgdGl0bGU9XCIke3RpdGxlfVwiYDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBvdXQgKz0gKDxhbnk+dGhpcy5vcHRpb25zKS54aHRtbCA/IFwiLz5cIiA6IFwiPlwiO1xyXG4gICAgICAgICAgICByZXR1cm4gb3V0O1xyXG4gICAgICAgICAgfTtcclxuICAgICAgICBjYXNlICdjb2RlJzpcclxuICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoY29kZTogYW55LCBsYW5ndWFnZTogYW55KSB7XHJcbiAgICAgICAgICAgIGxldCB2YWxpZExhbmcgPSAhIShsYW5ndWFnZSAmJiBobGpzLmdldExhbmd1YWdlKGxhbmd1YWdlKSk7XHJcbiAgICAgICAgICAgIGxldCBoaWdobGlnaHRlZCA9IHZhbGlkTGFuZyA/IGhsanMuaGlnaGxpZ2h0KGxhbmd1YWdlLCBjb2RlKS52YWx1ZSA6IGNvZGU7XHJcbiAgICAgICAgICAgIHJldHVybiBgPHByZSBzdHlsZT1cInBhZGRpbmc6IDA7IGJvcmRlci1yYWRpdXM6IDA7XCI+PGNvZGUgY2xhc3M9XCJobGpzICR7bGFuZ3VhZ2V9XCI+JHtoaWdobGlnaHRlZH08L2NvZGU+PC9wcmU+YDtcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgY2FzZSAndGFibGUnOlxyXG4gICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChoZWFkZXI6IHN0cmluZywgYm9keTogc3RyaW5nKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBgPHRhYmxlIGNsYXNzPVwidGFibGUgdGFibGUtYm9yZGVyZWRcIj5cXG48dGhlYWQ+XFxuJHtoZWFkZXJ9PC90aGVhZD5cXG48dGJvZHk+XFxuJHtib2R5fTwvdGJvZHk+XFxuPC90YWJsZT5cXG5gO1xyXG4gICAgICAgICAgfTtcclxuICAgICAgICBjYXNlICdsaXN0aXRlbSc6XHJcbiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHRleHQ6IGFueSwgdGFzazogYm9vbGVhbiwgY2hlY2tlZDogYm9vbGVhbikge1xyXG4gICAgICAgICAgICBpZiAoL15cXHMqXFxbW3ggXVxcXVxccyovLnRlc3QodGV4dCkgfHwgdGV4dC5zdGFydHNXaXRoKCc8aW5wdXQnKSkge1xyXG4gICAgICAgICAgICAgIGlmICh0ZXh0LnN0YXJ0c1dpdGgoJzxpbnB1dCcpKSB7XHJcbiAgICAgICAgICAgICAgICB0ZXh0ID0gdGV4dFxyXG4gICAgICAgICAgICAgICAgICAucmVwbGFjZSgnPGlucHV0IGRpc2FibGVkPVwiXCIgdHlwZT1cImNoZWNrYm94XCI+JywgJzxpIGNsYXNzPVwiZmEgZmEtc3F1YXJlLW9cIj48L2k+JylcclxuICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoJzxpbnB1dCBjaGVja2VkPVwiXCIgZGlzYWJsZWQ9XCJcIiB0eXBlPVwiY2hlY2tib3hcIj4nLCAnPGkgY2xhc3M9XCJmYSBmYS1jaGVjay1zcXVhcmVcIj48L2k+Jyk7XHJcbiAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRleHQgPSB0ZXh0XHJcbiAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9eXFxzKlxcWyBcXF1cXHMqLywgJzxpIGNsYXNzPVwiZmEgZmEtc3F1YXJlLW9cIj48L2k+ICcpXHJcbiAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9eXFxzKlxcW3hcXF1cXHMqLywgJzxpIGNsYXNzPVwiZmEgZmEtY2hlY2stc3F1YXJlXCI+PC9pPiAnKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgcmV0dXJuIGA8bGk+JHt0ZXh0fTwvbGk+YDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICByZXR1cm4gYDxsaT4ke3RleHR9PC9saT5gO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9O1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiJdfQ==